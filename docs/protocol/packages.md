# 应用层报文协议概述

* 单个报文长度包含头部总不能超过 512 字节
* 两个数据帧之间发送的时间间隔不能低于 120 毫秒
* 同一报文分包发送的数据帧之间的时间间隔不能大于 500 毫秒，否则视为失败

!!! note "注意"
    后续硬件升级可能会提升上述报文长度限制，以具体硬件为准。

## 应用层消息报文头

每个报文总是以固定 8 个字节的消息报文头开始：

```c
struct PackageHeader {
    uint8_t     Magic;  // 一个字节的报文标识，固定为 0x66
    uint32_t    ID;     // 4字节32位整型的报文 ID，用于标识报文
    uint8_t     Type;   // 一个自己的消息类型，用于标识此报文的类型，由具体协议定义。
    uint16_t    Size;   // 包含此头部的报文总长
};
```

* 如果报文是双向通信需要接收方响应，接收方响应的报文与发送方的报文 ID 相同。
* 报文 ID 通常可以使用 Unix 时间填充。


# 应用层消息报文定义

## 0x03 - 填充颜色设置

用于将整个矩阵填充为某个颜色索引，填充黑色就相当于关掉所有的 LED 灯珠。

### 报文定义

* 消息类型： `0x03`
* 报文总长：9 字节
* 报文应答：无

### 报文结构：

```c
struct SetPixel {
    uint8_t ColorIndex;    // 调色板颜色索引，范围 0~15
};
```

## 0x05 - 按照坐标设置单像素颜色

用于按照 X, Y 定义的列和行设置单个像素的颜色索引。

### 报文定义

* 消息类型： `0x05`
* 报文总长：13 字节
* 报文应答：无

### 报文结构：

```c
struct SetPixel {
    uint16_t X;            // 2字节16位列位置，从 0 开始
    uint16_t Y;            // 2字节16位行位置，从 0 开始
    uint8_t ColorIndex;    // 调色板颜色索引，范围 0~15
};
```