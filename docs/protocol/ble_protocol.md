# 蓝牙 BLE 协议改要

原生的蓝牙 BLE 协议类似 UDP，是一种无连接状态的协议。

由于原生 BLE 每次发送的数据不能超过 20 字节，不能够满足应用层的需要，因此我们在上面增补了应用层的协议报文。

原生的蓝牙 BLE 协议每次发送的20字节以内的数据称为**数据帧**，一个应用层报文超过 20 字节，需要拆分为多个数据帧发送。

本系统的多字节整数格式均使用**小端序**，也就是低位字节在前的格式。

# BLE 协议

BLE 层协议是低功耗蓝牙的原生协议，除了用于报文传输，也可以使用特征值 `0x0000FFE2` 来控制蓝牙模块进行一些底层操作，
但本系统暂未使用。

## 服务值/特征值

LED 矩阵控制器蓝牙的服务值：

* 蓝牙服务 UUID：`0x0000FFE0 `
* 蓝牙应用层报文传输特征值 UUID：`0x0000FFE1`
* 蓝牙控制特征值： UUID：`0x0000FFE2`


客户端发送应用层报文只需要要向特征值 `0xFFE1` 写入数据即可，大于 20 字节需要分包，参考应用层报文协议说明。

微信小程序操作蓝牙可参考微信官网文档：

https://developers.weixin.qq.com/miniprogram/dev/framework/device/bluetooth.html


## 关于演示的小程序

演示小程序的服务和特征值都是默认第一个，刚好符合本系统。实际的项目中，需要按照上面的服务/特征值参数过滤并检查广播的蓝牙模块。

实际项目的小程序 JavaScript 程序报文打包解包推荐使用 [DataStream.js](https://www.npmjs.com/package/datastream-js) 库。

**注意报文使用小端序（LITTLE_ENDIAN）。**